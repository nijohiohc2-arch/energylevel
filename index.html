<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜í˜¼ì˜ ì§€ë„: ì˜ì‹ê³¼ ì—ë„ˆì§€ ì¸í¬ê·¸ë˜í”½</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@300;500;700&family=Noto+Sans+KR:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        /* Chosen Palette: Ethereal Lavender & Gold */
        :root {
            --color-bg: #FDFBF7;
            --color-primary: #4C1D95; /* Deep Indigo */
            --color-accent: #D97706; /* Muted Gold */
            --color-soft-purple: #E9D5FF;
            --color-text: #1F2937;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            overflow-x: hidden;
        }

        h1, h2, h3, .serif {
            font-family: 'Noto Serif KR', serif;
        }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            height: 400px;
            max-height: 500px;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.05);
        }

        .breathing-circle {
            animation: breathe 8s infinite ease-in-out;
        }

        @keyframes breathe {
            0%, 100% { transform: scale(1); opacity: 0.6; }
            50% { transform: scale(1.5); opacity: 0.3; }
        }

        .fade-in {
            animation: fadeIn 0.8s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Custom Scrollbar for a cleaner look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #d8b4fe; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #c084fc; 
        }
    </style>
    <!-- Application Structure Plan: 
         1. Header: Immersive, spiritual title with a calming quote.
         2. Context: Brief intro about the "Source Report" (The Ethereal Map).
         3. Dashboard (The Mirror): Interactive Radar Chart to visualize personal energy balance (Body, Mind, Spirit, etc.). Added LLM feature for Action Plan.
         4. Exploration (The Ladder): Interactive list of 7 Consciousness Stages. Clicking reveals deep wisdom. Added LLM feature for Personalized Affirmations.
         5. Trends (The Collective): Line chart showing global shifts in awareness (mock data).
         6. Practice (The Breath): Simple CSS animation for breathing to encourage immediate application.
         Rationale: Moves from self-reflection -> knowledge (enhanced by LLM) -> global context -> practice.
    -->
    <!-- Visualization & Content Choices:
         - Radar Chart: Showing "Balance" across multiple dimensions. Enhanced by LLM-generated action plan.
         - Interactive List: Allows users to explore dense text (stages) at their own pace. Enhanced by LLM-generated affirmations.
         - Line Chart: Visualizes trends over time (frequency/vibration).
         - No SVG/Mermaid: All graphics are HTML/CSS or Chart.js canvas.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="selection:bg-purple-200 selection:text-purple-900">

    <!-- Hero Section -->
    <header class="relative min-h-[60vh] flex flex-col justify-center items-center text-center px-4 py-20 overflow-hidden">
        <div class="absolute inset-0 z-0 bg-gradient-to-b from-purple-50 via-white to-purple-50 opacity-80"></div>
        <div class="absolute top-0 left-0 w-full h-full overflow-hidden z-0">
            <div class="absolute top-10 left-10 w-64 h-64 bg-purple-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob"></div>
            <div class="absolute top-10 right-10 w-64 h-64 bg-yellow-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-2000"></div>
            <div class="absolute -bottom-8 left-20 w-64 h-64 bg-pink-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-4000"></div>
        </div>

        <div class="relative z-10 max-w-4xl mx-auto fade-in">
            <div class="inline-block px-4 py-1 mb-6 text-xs font-semibold tracking-widest text-purple-800 uppercase bg-purple-100 rounded-full">
                Interactive Spiritual Report
            </div>
            <h1 class="text-4xl md:text-6xl font-bold text-gray-900 mb-6 serif leading-tight">
                ì˜í˜¼ì˜ ì§€ë„: <br/> <span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-amber-500">ì˜ì‹ê³¼ ì—ë„ˆì§€ì˜ íë¦„</span>
            </h1>
            <p class="text-lg md:text-xl text-gray-600 mb-8 max-w-2xl mx-auto font-light leading-relaxed">
                ë³´ì´ì§€ ì•ŠëŠ” ê²ƒì„ ì‹œê°í™”í•˜ë‹¤. ë‹¹ì‹ ì˜ ë‚´ë©´ ì—ë„ˆì§€ ê· í˜•ì„ íƒêµ¬í•˜ê³ , ì˜ì‹ì˜ ì„±ì¥ì„ ìœ„í•œ ë°ì´í„°ë¥¼ í™•ì¸í•˜ì„¸ìš”.
            </p>
            <button onclick="scrollToSection('dashboard')" class="px-8 py-3 bg-gray-900 text-white rounded-full hover:bg-gray-800 transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-1">
                íƒí—˜ ì‹œì‘í•˜ê¸°
            </button>
        </div>
    </header>

    <!-- Context Section -->
    <section class="py-16 px-4 bg-white relative z-10">
        <div class="max-w-4xl mx-auto text-center">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 serif">ë³´ê³ ì„œ ê°œìš”: ë‚´ë©´ì˜ ë°ì´í„°</h2>
            <p class="text-gray-600 leading-relaxed mb-8">
                ì´ ì¸í„°ë™í‹°ë¸Œ ë¦¬í¬íŠ¸ëŠ” ì˜ì ì¸ ì„±ì¥ê³¼ ë‚´ë©´ì˜ í‰í™”ë¥¼ 'ì¸í¬ê·¸ë˜í”½' í˜•íƒœë¡œ ì¬í•´ì„í•œ ê²ƒì…ë‹ˆë‹¤. 
                ì¶”ìƒì ì¸ ê°œë…ì¸ <strong>ì—ë„ˆì§€(Energy), ì˜ì‹(Consciousness), ê· í˜•(Balance)</strong>ì„ 
                ì‹œê°ì  ë°ì´í„°ë¡œ ë³€í™˜í•˜ì—¬, ì‚¬ìš©ìê°€ ì§ê´€ì ìœ¼ë¡œ ìì‹ ì˜ ìƒíƒœë¥¼ ì´í•´í•˜ê³  ì„±ì°°í•  ìˆ˜ ìˆë„ë¡ ë•ìŠµë‹ˆë‹¤.
            </p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-left">
                <div class="p-6 bg-purple-50 rounded-2xl">
                    <div class="text-purple-600 text-2xl mb-2">âœ¦</div>
                    <h3 class="font-bold text-gray-800 mb-2">ê· í˜• (Balance)</h3>
                    <p class="text-sm text-gray-600">ì‚¶ì˜ 5ê°€ì§€ í•µì‹¬ ì˜ì—­ ê°„ì˜ ì¡°í™”ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤.</p>
                </div>
                <div class="p-6 bg-amber-50 rounded-2xl">
                    <div class="text-amber-600 text-2xl mb-2">â–²</div>
                    <h3 class="font-bold text-gray-800 mb-2">ìƒìŠ¹ (Ascension)</h3>
                    <p class="text-sm text-gray-600">ì˜ì‹ ìˆ˜ì¤€ì˜ ë‹¨ê³„ë³„ íŠ¹ì§•ê³¼ ì„±ì¥ ê³¼ì •ì„ íƒêµ¬í•©ë‹ˆë‹¤.</p>
                </div>
                <div class="p-6 bg-teal-50 rounded-2xl">
                    <div class="text-teal-600 text-2xl mb-2">âˆ</div>
                    <h3 class="font-bold text-gray-800 mb-2">ì—°ê²° (Connection)</h3>
                    <p class="text-sm text-gray-600">ê°œì¸ì˜ ë³€í™”ê°€ ì§‘ë‹¨ ì˜ì‹ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ì‹œê°í™”í•©ë‹ˆë‹¤.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Dashboard Section: The Mirror (Radar Chart) -->
    <section id="dashboard" class="py-20 px-4 bg-gray-50">
        <div class="max-w-6xl mx-auto">
            <div class="flex flex-col md:flex-row gap-12 items-start">
                
                <!-- Controls & Explanation -->
                <div class="w-full md:w-1/3">
                    <h2 class="text-3xl font-bold text-gray-900 mb-4 serif">ë‚´ë©´ì˜ ë‚˜ì¹¨ë°˜</h2>
                    <p class="text-gray-600 mb-6 text-sm">
                        ì•„ë˜ ìŠ¬ë¼ì´ë”ë¥¼ ì¡°ì ˆí•˜ì—¬ í˜„ì¬ ë‹¹ì‹ ì˜ ìƒíƒœë¥¼ ì…ë ¥í•´ë³´ì„¸ìš”. 
                        ì˜¤ë¥¸ìª½ ì°¨íŠ¸ê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ ë³€í™”í•˜ë©° ë‹¹ì‹ ì˜ 'ì˜ì  ê· í˜•ë„'ë¥¼ ì‹œê°í™”í•©ë‹ˆë‹¤.
                    </p>

                    <div class="space-y-4 bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <!-- Sliders -->
                        <div>
                            <label class="flex justify-between text-sm font-medium text-gray-700 mb-1">
                                <span>ì‹ ì²´ (Body)</span> <span id="val-body">70%</span>
                            </label>
                            <input type="range" id="input-body" min="0" max="100" value="70" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-purple-600">
                        </div>
                        <div>
                            <label class="flex justify-between text-sm font-medium text-gray-700 mb-1">
                                <span>ë§ˆìŒ (Mind)</span> <span id="val-mind">60%</span>
                            </label>
                            <input type="range" id="input-mind" min="0" max="100" value="60" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-purple-600">
                        </div>
                        <div>
                            <label class="flex justify-between text-sm font-medium text-gray-700 mb-1">
                                <span>ê°ì • (Emotion)</span> <span id="val-emotion">50%</span>
                            </label>
                            <input type="range" id="input-emotion" min="0" max="100" value="50" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-purple-600">
                        </div>
                        <div>
                            <label class="flex justify-between text-sm font-medium text-gray-700 mb-1">
                                <span>ì˜ì„± (Spirit)</span> <span id="val-spirit">80%</span>
                            </label>
                            <input type="range" id="input-spirit" min="0" max="100" value="80" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-purple-600">
                        </div>
                        <div>
                            <label class="flex justify-between text-sm font-medium text-gray-700 mb-1">
                                <span>ê´€ê³„ (Social)</span> <span id="val-social">65%</span>
                            </label>
                            <input type="range" id="input-social" min="0" max="100" value="65" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-purple-600">
                        </div>
                    </div>

                    <div class="mt-6 p-4 bg-indigo-50 rounded-xl border border-indigo-100">
                        <h4 class="font-bold text-indigo-900 text-sm mb-1">í˜„ì¬ ìƒíƒœ ë¶„ì„:</h4>
                        <p id="analysis-text" class="text-sm text-indigo-800">
                            ë°ì´í„°ë¥¼ ì…ë ¥í•˜ì—¬ ë¶„ì„ì„ ì‹œì‘í•˜ì„¸ìš”.
                        </p>
                    </div>

                    <!-- Gemini Feature 2: Balance Action Plan -->
                    <button id="plan-button" onclick="generateBalancePlan()" class="mt-4 w-full px-4 py-2 bg-purple-600 text-white font-bold rounded-lg shadow-lg hover:bg-purple-700 transition-colors flex items-center justify-center disabled:opacity-50" disabled>
                        <span id="plan-button-text">âœ¨ ê· í˜• í”Œëœ ìƒì„±</span>
                    </button>

                    <div id="plan-results" class="mt-4 p-4 bg-white rounded-xl shadow-md border border-purple-200 hidden">
                        <h4 class="font-bold text-purple-800 mb-2 flex items-center">
                            <svg class="w-5 h-5 mr-2 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.046 12.001 12.001 0 00-1.806 13.567A11.955 11.955 0 0012 21.056a11.955 11.955 0 008.424-3.094 12.001 12.001 0 00-1.806-13.567z"></path></svg>
                            ë‚˜ë§Œì˜ ì‹¤ì²œ ê³„íš
                        </h4>
                        <div id="plan-content" class="text-sm text-gray-700 space-y-1"></div>
                    </div>
                </div>

                <!-- Radar Chart Visualization -->
                <div class="w-full md:w-2/3 bg-white rounded-3xl p-4 md:p-8 shadow-lg border border-gray-100 flex flex-col justify-center items-center">
                    <div class="chart-container">
                        <canvas id="balanceChart"></canvas>
                    </div>
                    <p class="text-xs text-center text-gray-400 mt-4">ì˜ì  ì—ë„ˆì§€ ê· í˜• ë‹¤ì´ì–´ê·¸ë¨ (Spiritual Energy Balance Diagram)</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Exploration Section: 7 Stages (Vertical Timeline) -->
    <section class="py-20 px-4 relative overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-br from-purple-50 to-white opacity-50 z-0"></div>
        <div class="max-w-5xl mx-auto relative z-10">
            <div class="text-center mb-16">
                <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4 serif">ì˜ì‹ì˜ 7ë‹¨ê³„ (The 7 Stages)</h2>
                <p class="text-gray-600 max-w-2xl mx-auto">
                    ì˜ì‹ì€ ì„ í˜•ì ìœ¼ë¡œ ì„±ì¥í•˜ì§€ ì•Šê³  ë‚˜ì„ í˜•ìœ¼ë¡œ ì§„í™”í•©ë‹ˆë‹¤. ê° ë‹¨ê³„ë¥¼ í´ë¦­í•˜ì—¬ ê·¸ ë‹¨ê³„ê°€ ê°€ì§„ ì—ë„ˆì§€ì™€ ì§€í˜œë¥¼ íƒêµ¬í•´ë³´ì„¸ìš”.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Interactive List -->
                <div class="space-y-3" id="stages-list">
                    <!-- Javascript will populate this -->
                </div>

                <!-- Detail View (Sticky) -->
                <div class="relative">
                    <div class="sticky top-10 glass-card rounded-2xl p-8 transition-all duration-500" id="stage-detail-card">
                        <div class="flex items-center gap-4 mb-6">
                            <div id="detail-icon" class="w-16 h-16 rounded-full flex items-center justify-center text-2xl bg-gray-100 text-gray-500 shadow-inner">?</div>
                            <div>
                                <h3 id="detail-title" class="text-2xl font-bold text-gray-900 serif">ë‹¨ê³„ë¥¼ ì„ íƒí•˜ì„¸ìš”</h3>
                                <p id="detail-subtitle" class="text-sm text-purple-600 font-medium">íƒí—˜ì„ ì‹œì‘í•˜ë ¤ë©´ ì™¼ìª½ ëª©ë¡ì„ í´ë¦­í•˜ì„¸ìš”</p>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <p id="detail-desc" class="text-gray-600 leading-relaxed">
                                ê° ë‹¨ê³„ëŠ” ìš°ë¦¬ê°€ ì„¸ìƒì„ ì¸ì‹í•˜ëŠ” ë Œì¦ˆì™€ ê°™ìŠµë‹ˆë‹¤. ë‚®ì€ ë‹¨ê³„ëŠ” ìƒì¡´ê³¼ ì•ˆì „ì— ì§‘ì¤‘í•˜ì§€ë§Œ, ë†’ì€ ë‹¨ê³„ë¡œ ê°ˆìˆ˜ë¡ ì—°ê²°ê³¼ í†µí•©ì„ ì§€í–¥í•©ë‹ˆë‹¤.
                            </p>
                            <div class="h-px bg-gray-200 w-full my-4"></div>
                            
                            <!-- Gemini Feature 1 Button -->
                            <button id="affirmation-button" onclick="generateAffirmation()" class="w-full px-4 py-2 bg-amber-500 text-white font-bold rounded-lg shadow-lg hover:bg-amber-600 transition-colors flex items-center justify-center text-sm disabled:opacity-50">
                                <span id="affirmation-button-text">âœ¨ ë§ì¶¤í˜• ì„±ì°° ìƒì„±</span>
                            </button>
                            
                            <div id="affirmation-results" class="mt-4 p-4 bg-yellow-50 rounded-xl border border-yellow-100 hidden">
                                <h4 class="text-xs font-bold text-yellow-800 mb-1">ğŸ’¡ ì˜¤ëŠ˜ì˜ ì„±ì°°</h4>
                                <p id="affirmation-content" class="text-sm text-yellow-900 italic leading-relaxed"></p>
                            </div>

                            <div>
                                <h4 class="text-sm font-bold text-gray-800 mb-2 uppercase tracking-wide">Key Attribute (í•µì‹¬ ì†ì„±)</h4>
                                <div id="detail-attributes" class="flex flex-wrap gap-2">
                                    <span class="px-3 py-1 bg-gray-100 text-gray-500 rounded-full text-xs">Waiting...</span>
                                </div>
                            </div>
                            <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-100 mt-4">
                                <h4 class="text-xs font-bold text-yellow-800 mb-1">ğŸ’¡ Insight (í†µì°°)</h4>
                                <p id="detail-insight" class="text-sm text-yellow-900 italic">"ëª¨ë“  ì—¬ì •ì€ ì²« ê±¸ìŒì—ì„œ ì‹œì‘ë©ë‹ˆë‹¤."</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Trend Section: Collective Vibration (Line Chart) -->
    <section class="py-20 px-4 bg-gray-900 text-white">
        <div class="max-w-6xl mx-auto">
            <div class="flex flex-col md:flex-row gap-12 items-center">
                <div class="w-full md:w-2/3">
                    <div class="chart-container" style="height: 350px;">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>
                <div class="w-full md:w-1/3">
                    <h2 class="text-3xl font-bold mb-4 serif text-purple-300">ì§‘ë‹¨ ì˜ì‹ì˜ íë¦„</h2>
                    <p class="text-gray-400 mb-6 leading-relaxed">
                        ê°œì¸ì˜ ë³€í™”ëŠ” ì§‘ë‹¨ì˜ ë³€í™”ë¡œ ì´ì–´ì§‘ë‹ˆë‹¤. ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„°ì— ë”°ë¥´ë©´, ëª…ìƒê³¼ ë‚´ë©´ íƒêµ¬ê°€ ì¦ê°€í•¨ì— ë”°ë¼ ì‚¬íšŒì  ìŠ¤íŠ¸ë ˆìŠ¤ ì§€ìˆ˜ëŠ” ê°ì†Œí•˜ê³  ì§‘ë‹¨ ê³µê° ì§€ìˆ˜ëŠ” ìƒìŠ¹í•˜ëŠ” ê²½í–¥ì„ ë³´ì…ë‹ˆë‹¤.
                    </p>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between border-b border-gray-700 pb-2">
                            <span class="text-sm text-gray-400">í‰ê·  ëª…ìƒ ì‹œê°„</span>
                            <span class="font-bold text-teal-400">â–² 24% ì¦ê°€</span>
                        </div>
                        <div class="flex items-center justify-between border-b border-gray-700 pb-2">
                            <span class="text-sm text-gray-400">ì‚¬íšŒì  ì—°ê²°ê°</span>
                            <span class="font-bold text-purple-400">â–² 18% ìƒìŠ¹</span>
                        </div>
                        <div class="flex items-center justify-between border-b border-gray-700 pb-2">
                            <span class="text-sm text-gray-400">ìŠ¤íŠ¸ë ˆìŠ¤ ì§€ìˆ˜</span>
                            <span class="font-bold text-red-400">â–¼ 12% ê°ì†Œ</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Practice Section: Breathing -->
    <section class="py-24 px-4 bg-purple-50 flex flex-col items-center justify-center text-center relative overflow-hidden">
        <div class="absolute w-96 h-96 bg-white rounded-full opacity-50 blur-3xl breathing-circle"></div>
        
        <div class="relative z-10 max-w-2xl">
            <h2 class="text-3xl font-bold text-gray-900 mb-4 serif">ì ì‹œ ë©ˆì¶¤ (Pause)</h2>
            <p class="text-gray-600 mb-8">
                ëª¨ë“  ë°ì´í„°ì™€ ì •ë³´ëŠ” ê²°êµ­ 'ì§€ê¸ˆ ì´ ìˆœê°„'ì˜ í‰ì˜¨í•¨ì„ ìœ„í•œ ê²ƒì…ë‹ˆë‹¤.<br>
                ì›ì˜ ì›€ì§ì„ì— ë§ì¶° ê¹Šê²Œ í˜¸í¡í•´ë³´ì„¸ìš”.
            </p>
            
            <div class="relative w-64 h-64 mx-auto flex items-center justify-center mb-8">
                <!-- Outer Rings -->
                <div class="absolute w-full h-full border border-purple-200 rounded-full animate-[spin_10s_linear_infinite]"></div>
                <div class="absolute w-48 h-48 border border-purple-300 rounded-full animate-[spin_15s_linear_infinite_reverse]"></div>
                
                <!-- Core Breathing Element -->
                <div class="w-32 h-32 bg-gradient-to-br from-purple-400 to-indigo-500 rounded-full shadow-2xl flex items-center justify-center text-white font-serif italic text-lg breathing-circle">
                    Breathe
                </div>
            </div>

            <button onclick="alert('í‰ì˜¨í•¨ì„ ì„ íƒí•˜ì…¨ìŠµë‹ˆë‹¤. ì˜¤ëŠ˜ë„ í‰í™”ë¡œìš´ í•˜ë£¨ ë˜ì„¸ìš”.')" class="mt-8 text-sm text-purple-600 hover:text-purple-800 underline underline-offset-4 decoration-purple-300">
                ì´ ìˆœê°„ì„ ê¸°ì–µí•˜ê¸°
            </button>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-white py-10 text-center text-gray-400 text-sm border-t border-gray-100">
        <p class="serif mb-2">Spiritual Infographic Project</p>
        <p>Inspired by the journey within.</p>
    </footer>

    <script>
        // --- Gemini API Configuration ---
        const apiKey = ""; 
        const apiUrl = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent";
        const maxRetries = 5;

        async function exponentialBackoffFetch(url, options) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.status !== 429) {
                        return response;
                    }
                    console.log(`Rate limit exceeded, retrying in ${2 ** i}s...`);
                } catch (error) {
                    console.error("Fetch error, retrying:", error);
                }
                await new Promise(resolve => setTimeout(resolve, 1000 * 2 ** i));
            }
            throw new Error("API call failed after multiple retries.");
        }
        
        // --- State Management ---
        const state = {
            balance: { body: 70, mind: 60, emotion: 50, spirit: 80, social: 65 },
            activeStageId: 1
        };

        // --- Data: 7 Stages of Consciousness ---
        const stagesData = [
            {
                id: 1,
                name: "1. ìƒì¡´ (Survival)",
                color: "bg-red-100 text-red-800",
                borderColor: "border-red-200",
                icon: "ğŸŒ±",
                desc: "ê°€ì¥ ê¸°ì´ˆì ì¸ ë‹¨ê³„ì…ë‹ˆë‹¤. ë¬¼ë¦¬ì  ìƒì¡´, ì•ˆì „, ê±´ê°•ì— ì§‘ì¤‘í•©ë‹ˆë‹¤. ë‘ë ¤ì›€ì„ ê·¹ë³µí•˜ê³  ì•ˆì •ê°ì„ ì°¾ëŠ” ê²ƒì´ ëª©í‘œì…ë‹ˆë‹¤.",
                attributes: ["ì•ˆì •ê°", "ê±´ê°•", "ë¬¼ì§ˆì  í’ìš”"],
                insight: "ë‹¹ì‹ ì€ ì•ˆì „í•©ë‹ˆë‹¤. ëŒ€ì§€ëŠ” ë‹¹ì‹ ì„ ì§€ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤."
            },
            {
                id: 2,
                name: "2. ê´€ê³„ (Flow)",
                color: "bg-orange-100 text-orange-800",
                borderColor: "border-orange-200",
                icon: "ğŸŒŠ",
                desc: "ê°ì •ê³¼ ì°½ì¡°ì„±ì˜ ë‹¨ê³„ì…ë‹ˆë‹¤. íƒ€ì¸ê³¼ì˜ ê´€ê³„, ì¦ê±°ì›€, ìœ ì—°ì„±ì„ ë°°ì›ë‹ˆë‹¤. ì£„ì±…ê°ì„ ë†“ê³  íë¦„ì— ë§¡ê¸°ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.",
                attributes: ["ì°½ì¡°ì„±", "ê°ì • í‘œí˜„", "ìœ ì—°í•¨"],
                insight: "ê°ì •ì€ ë¬¼ê³¼ ê°™ìŠµë‹ˆë‹¤. ë§‰ì§€ ë§ê³  íë¥´ê²Œ ë‘ì„¸ìš”."
            },
            {
                id: 3,
                name: "3. ì˜ì§€ (Will)",
                color: "bg-yellow-100 text-yellow-800",
                borderColor: "border-yellow-200",
                icon: "ğŸ”¥",
                desc: "ìì•„ì™€ í–‰ë™ë ¥ì˜ ë‹¨ê³„ì…ë‹ˆë‹¤. ìì‹ ê°, ê²°ë‹¨ë ¥, ìì¡´ê°ì„ í™•ë¦½í•©ë‹ˆë‹¤. ìˆ˜ì¹˜ì‹¬ì„ ë„˜ì–´ ìì‹ ì˜ í˜ì„ ê¸ì •í•˜ì„¸ìš”.",
                attributes: ["ìì‹ ê°", "í–‰ë™ë ¥", "ëª©í‘œ ë‹¬ì„±"],
                insight: "ë‹¹ì‹ ì—ê²ŒëŠ” ì‚¶ì„ ë³€í™”ì‹œí‚¬ í˜ì´ ìˆìŠµë‹ˆë‹¤."
            },
            {
                id: 4,
                name: "4. ì‚¬ë‘ (Love)",
                color: "bg-green-100 text-green-800",
                borderColor: "border-green-200",
                icon: "ğŸ’š",
                desc: "ë§ˆìŒì˜ ì¤‘ì‹¬ì…ë‹ˆë‹¤. ì¡°ê±´ ì—†ëŠ” ì‚¬ë‘, ìš©ì„œ, ì—°ë¯¼ì„ ê²½í—˜í•©ë‹ˆë‹¤. ìŠ¬í””ì„ ì¹˜ìœ í•˜ê³  ì§„ì •í•œ ì—°ê²°ì„ ë§ºìŠµë‹ˆë‹¤.",
                attributes: ["ìš©ì„œ", "ì—°ë¯¼", "í‰í™”"],
                insight: "ì‚¬ë‘ì€ ê°ì •ì´ ì•„ë‹ˆë¼ ì¡´ì¬ì˜ ìƒíƒœì…ë‹ˆë‹¤."
            },
            {
                id: 5,
                name: "5. í‘œí˜„ (Truth)",
                color: "bg-blue-100 text-blue-800",
                borderColor: "border-blue-200",
                icon: "ğŸ—£ï¸",
                desc: "ì§„ì‹¤ê³¼ ì†Œí†µì˜ ë‹¨ê³„ì…ë‹ˆë‹¤. ìì‹ ì˜ ì§„ì‹¤ì„ ë§í•˜ê³ , íƒ€ì¸ì˜ ì§„ì‹¤ì„ ê²½ì²­í•©ë‹ˆë‹¤. ê±°ì§“ì„ ë²„ë¦¬ê³  ì •ì§í•´ì§€ì„¸ìš”.",
                attributes: ["ì •ì§", "ì†Œí†µ", "ìê¸°í‘œí˜„"],
                insight: "ë‹¹ì‹ ì˜ ëª©ì†Œë¦¬ëŠ” ì„¸ìƒì— í•„ìš”í•œ ê³ ìœ í•œ ìš¸ë¦¼ì…ë‹ˆë‹¤."
            },
            {
                id: 6,
                name: "6. ì§ê´€ (Insight)",
                color: "bg-indigo-100 text-indigo-800",
                borderColor: "border-indigo-200",
                icon: "ğŸ‘ï¸",
                desc: "ì§€í˜œì™€ í†µì°°ì˜ ë‹¨ê³„ì…ë‹ˆë‹¤. ë…¼ë¦¬ë¥¼ ë„˜ì–´ì„  ì§ê´€, ìƒìƒë ¥, ë¹„ì „ì„ ë´…ë‹ˆë‹¤. í™˜ìƒì„ ê±·ì–´ë‚´ê³  ë³¸ì§ˆì„ ë´…ë‹ˆë‹¤.",
                attributes: ["í†µì°°ë ¥", "ì§€í˜œ", "ìƒìƒë ¥"],
                insight: "ëˆˆì— ë³´ì´ëŠ” ê²ƒë³´ë‹¤ ë³´ì´ì§€ ì•ŠëŠ” ê²ƒì´ ë” ë§ì€ ê²ƒì„ ë§í•´ì¤ë‹ˆë‹¤."
            },
            {
                id: 7,
                name: "7. í†µí•© (Unity)",
                color: "bg-purple-100 text-purple-800",
                borderColor: "border-purple-200",
                icon: "âœ¨",
                desc: "ìˆœìˆ˜ ì˜ì‹ê³¼ í†µí•©ì˜ ë‹¨ê³„ì…ë‹ˆë‹¤. ëª¨ë“  ê²ƒì´ ì—°ê²°ë˜ì–´ ìˆìŒì„ ê¹¨ë‹«ìŠµë‹ˆë‹¤. ë¶„ë¦¬ê°ì„ ë„˜ì–´ì„  ì˜¨ì „í•¨ì„ ê²½í—˜í•©ë‹ˆë‹¤.",
                attributes: ["ê¹¨ë‹¬ìŒ", "ì´ˆì›”", "ì¼ì²´ê°"],
                insight: "ìš°ë¦¬ëŠ” ì„œë¡œ ë‹¤ë¥¸ íŒŒë„ê°€ ì•„ë‹ˆë¼ ê°™ì€ ë°”ë‹¤ì…ë‹ˆë‹¤."
            }
        ];

        // --- Chart Initialization ---
        let balanceChartInstance = null;
        let trendChartInstance = null;

        function initCharts() {
            // 1. Radar Chart (Balance)
            const ctxBalance = document.getElementById('balanceChart').getContext('2d');
            const gradientBalance = ctxBalance.createRadialGradient(200, 200, 0, 200, 200, 200);
            gradientBalance.addColorStop(0, 'rgba(167, 139, 250, 0.2)'); 
            gradientBalance.addColorStop(1, 'rgba(251, 191, 36, 0.1)'); 

            balanceChartInstance = new Chart(ctxBalance, {
                type: 'radar',
                data: {
                    labels: ['ì‹ ì²´ (Body)', 'ë§ˆìŒ (Mind)', 'ê°ì • (Emotion)', 'ì˜ì„± (Spirit)', 'ê´€ê³„ (Social)'],
                    datasets: [{
                        label: 'ë‚˜ì˜ ì—ë„ˆì§€ ê· í˜•',
                        data: [state.balance.body, state.balance.mind, state.balance.emotion, state.balance.spirit, state.balance.social],
                        backgroundColor: gradientBalance,
                        borderColor: '#7C3AED', 
                        borderWidth: 2,
                        pointBackgroundColor: '#F59E0B', 
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#7C3AED'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: { color: '#E5E7EB' },
                            grid: { color: '#F3F4F6' },
                            pointLabels: {
                                font: { family: "'Noto Sans KR', sans-serif", size: 12, weight: 'bold' },
                                color: '#4B5563'
                            },
                            suggestedMin: 0,
                            suggestedMax: 100,
                            ticks: { display: false } 
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(255, 255, 255, 0.9)',
                            titleColor: '#1F2937',
                            bodyColor: '#4B5563',
                            borderColor: '#E5E7EB',
                            borderWidth: 1,
                            padding: 10,
                            displayColors: false
                        }
                    }
                }
            });

            // 2. Line Chart (Trends)
            const ctxTrend = document.getElementById('trendChart').getContext('2d');
            const gradientTrend = ctxTrend.createLinearGradient(0, 0, 0, 400);
            gradientTrend.addColorStop(0, 'rgba(45, 212, 191, 0.5)'); 
            gradientTrend.addColorStop(1, 'rgba(45, 212, 191, 0.0)');

            trendChartInstance = new Chart(ctxTrend, {
                type: 'line',
                data: {
                    labels: ['2020', '2021', '2022', '2023', '2024', '2025(ì˜ˆì¸¡)'],
                    datasets: [
                        {
                            label: 'ì§‘ë‹¨ ê³µê° ì§€ìˆ˜ (Collective Empathy)',
                            data: [45, 48, 52, 55, 62, 70],
                            borderColor: '#2DD4BF', 
                            backgroundColor: gradientTrend,
                            tension: 0.4,
                            fill: true,
                            borderWidth: 3
                        },
                        {
                            label: 'ì‚¬íšŒì  ìŠ¤íŠ¸ë ˆìŠ¤ (Social Stress)',
                            data: [80, 75, 72, 65, 60, 55],
                            borderColor: '#F87171', 
                            borderDash: [5, 5],
                            tension: 0.4,
                            fill: false,
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            grid: { color: '#374151' },
                            ticks: { color: '#9CA3AF' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#9CA3AF' }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: { color: '#E5E7EB', font: { family: "'Noto Sans KR', sans-serif" } }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(17, 24, 39, 0.9)',
                            titleColor: '#fff',
                            bodyColor: '#D1D5DB'
                        }
                    }
                }
            });
        }

        // --- Interaction Logic ---
        function updateRadarChart() {
            balanceChartInstance.data.datasets[0].data = [
                state.balance.body,
                state.balance.mind,
                state.balance.emotion,
                state.balance.spirit,
                state.balance.social
            ];
            balanceChartInstance.update();
            analyzeBalance();
            document.getElementById('plan-button').disabled = false;
        }

        function analyzeBalance() {
            const values = Object.values(state.balance);
            const avg = values.reduce((a, b) => a + b, 0) / values.length;
            const min = Math.min(...values);
            const max = Math.max(...values);
            const spread = max - min;
            
            let message = "";

            if (spread < 20 && avg > 70) {
                message = "ë§¤ìš° ì¡°í™”ë¡­ê³  ë†’ì€ ì—ë„ˆì§€ë¥¼ ìœ ì§€í•˜ê³  ê³„ì‹­ë‹ˆë‹¤. í›Œë¥­í•©ë‹ˆë‹¤!";
            } else if (spread < 20) {
                message = "ì „ë°˜ì ì¸ ê· í˜•ì€ ì¢‹ìœ¼ë‚˜, ì „ì²´ì ì¸ ì—ë„ˆì§€ ë ˆë²¨ì„ ì¡°ê¸ˆ ë” ë†’ì—¬ë³´ì„¸ìš”.";
            } else if (state.balance.spirit > state.balance.body + 20) {
                message = "ì˜ì ì¸ ê°ê°ì€ ë›°ì–´ë‚˜ì§€ë§Œ, ì‹ ì²´(Body)ì™€ì˜ ì—°ê²°ì´ í•„ìš”í•´ ë³´ì…ë‹ˆë‹¤. ê·¸ë¼ìš´ë”©(Grounding)ì´ ë„ì›€ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
            } else if (state.balance.mind > state.balance.emotion + 20) {
                message = "ì´ì„±ì ì¸ ì‚¬ê³ ê°€ ê°•í•©ë‹ˆë‹¤. ê°ì •(Emotion)ì˜ íë¦„ì„ ì¡°ê¸ˆ ë” í—ˆìš©í•˜ë©´ ë” í° í‰í™”ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
            } else {
                message = "íŠ¹ì • ì˜ì—­ì— ì—ë„ˆì§€ê°€ ì§‘ì¤‘ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë‚®ì€ ìˆ˜ì¹˜ì˜ ì˜ì—­ì„ ëŒë³´ëŠ” ì‹œê°„ì„ ê°€ì ¸ë³´ì„¸ìš”.";
            }

            document.getElementById('analysis-text').innerText = message;
        }

        function setupSliders() {
            const inputs = ['body', 'mind', 'emotion', 'spirit', 'social'];
            inputs.forEach(key => {
                const el = document.getElementById(`input-${key}`);
                const display = document.getElementById(`val-${key}`);
                
                el.addEventListener('input', (e) => {
                    const val = parseInt(e.target.value);
                    state.balance[key] = val;
                    display.innerText = val + "%";
                    updateRadarChart();
                });
            });
        }

        function renderStagesList() {
            const container = document.getElementById('stages-list');
            container.innerHTML = stagesData.map((stage, index) => `
                <div class="stage-item cursor-pointer p-4 rounded-xl border transition-all duration-300 hover:shadow-md flex items-center gap-4 ${index === 0 ? 'border-purple-300 bg-purple-50 shadow-md ring-2 ring-purple-100' : 'border-gray-100 bg-white hover:border-purple-200'}"
                     onclick="selectStage(${stage.id}, this)">
                    <div class="w-10 h-10 rounded-full flex items-center justify-center text-lg ${stage.color}">
                        ${stage.icon}
                    </div>
                    <div>
                        <h4 class="font-bold text-gray-800 text-sm md:text-base">${stage.name}</h4>
                    </div>
                    <div class="ml-auto text-gray-400">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </div>
                </div>
            `).join('');

            selectStage(1, container.firstElementChild);
        }

        function selectStage(id, element) {
            state.activeStageId = id;
            
            document.querySelectorAll('.stage-item').forEach(el => {
                el.classList.remove('border-purple-300', 'bg-purple-50', 'shadow-md', 'ring-2', 'ring-purple-100');
                el.classList.add('border-gray-100', 'bg-white');
            });
            if(element) {
                element.classList.remove('border-gray-100', 'bg-white');
                element.classList.add('border-purple-300', 'bg-purple-50', 'shadow-md', 'ring-2', 'ring-purple-100');
            }

            const data = stagesData.find(s => s.id === id);
            const card = document.getElementById('stage-detail-card');
            
            card.style.opacity = '0.5';
            setTimeout(() => {
                document.getElementById('detail-icon').innerHTML = data.icon;
                document.getElementById('detail-icon').className = `w-16 h-16 rounded-full flex items-center justify-center text-3xl shadow-inner ${data.color}`;
                document.getElementById('detail-title').innerText = data.name;
                document.getElementById('detail-subtitle').innerText = `Level ${data.id} Frequency`;
                document.getElementById('detail-desc').innerText = data.desc;
                document.getElementById('detail-insight').innerText = `"${data.insight}"`;
                
                const attrContainer = document.getElementById('detail-attributes');
                attrContainer.innerHTML = data.attributes.map(attr => 
                    `<span class="px-3 py-1 bg-white border border-gray-200 text-gray-600 rounded-full text-xs shadow-sm">${attr}</span>`
                ).join('');

                card.style.opacity = '1';
                
                // Clear affirmation results on stage change
                document.getElementById('affirmation-results').classList.add('hidden');

            }, 150);
        }

        function scrollToSection(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
        }

        // --- Gemini Feature 1: Affirmation Generation ---
        async function generateAffirmation() {
            const stage = stagesData.find(s => s.id === state.activeStageId);
            const btn = document.getElementById('affirmation-button');
            const btnText = document.getElementById('affirmation-button-text');
            const resultBox = document.getElementById('affirmation-results');
            const resultContent = document.getElementById('affirmation-content');

            if (!stage) return;

            const originalText = btnText.innerText;
            btn.disabled = true;
            btnText.innerText = 'ìƒì„± ì¤‘... (ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”)';
            resultContent.innerHTML = '<span class="text-gray-500">ì§€í˜œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</span>';
            resultBox.classList.remove('hidden');

            const systemPrompt = "ë‹¹ì‹ ì€ ì˜ì ì¸ ê°€ì´ë“œì…ë‹ˆë‹¤. í˜„ì¬ ì‚¬ìš©ìëŠ” í•œêµ­ì–´ ì‚¬ìš©ìì´ë©°, ì´ ë‹¨ê³„ì˜ í•µì‹¬ ì„¤ëª…ê³¼ í†µì°°ì„ ë°”íƒ•ìœ¼ë¡œ, ì´ ë‹¨ê³„ë¥¼ ë” ê¹Šì´ ì´í•´í•˜ê³  í†µí•©í•  ìˆ˜ ìˆë„ë¡ ë•ëŠ” í•œêµ­ì–´ ë§ì¶¤í˜• 'ë‹¨ë½ ì„±ì°° ë©”ì‹œì§€' ë˜ëŠ” 'êµ¬ì²´ì ì¸ ìˆ˜í–‰ ì§€ì¹¨'ì„ ìƒì„±í•´ì£¼ì„¸ìš”. ë‹¤ë¥¸ ì„œë¡ ì´ë‚˜ ê²°ë¡  ì—†ì´ ìš”ì²­ëœ ë‚´ìš©ë§Œ ì œê³µí•˜ê³ , ì¡´ëŒ“ë§ì„ ì‚¬ìš©í•˜ì„¸ìš”.";
            
            const userQuery = `í˜„ì¬ íƒìƒ‰ ë‹¨ê³„: ${stage.name} (${stage.icon}). ì´ ë‹¨ê³„ì˜ í•µì‹¬ ì„¤ëª…: "${stage.desc}" í†µì°°: "${stage.insight}". ì´ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê°œì¸í™”ëœ ì„±ì°° ë©”ì‹œì§€ë¥¼ 100ì ë‚´ì™¸ë¡œ ìƒì„±í•´ì£¼ì„¸ìš”.`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            try {
                const response = await exponentialBackoffFetch(apiUrl + `?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text || "ì£„ì†¡í•©ë‹ˆë‹¤. ì˜ì ì¸ ì§€í˜œë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.";
                
                resultContent.innerHTML = text.replace(/\n/g, '<br>');

            } catch (error) {
                console.error("Gemini API Error for Affirmation:", error);
                resultContent.innerHTML = "API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.";
            } finally {
                btn.disabled = false;
                btnText.innerText = originalText;
            }
        }

        // --- Gemini Feature 2: Balance Action Plan Generation ---
        async function generateBalancePlan() {
            const btn = document.getElementById('plan-button');
            const btnText = document.getElementById('plan-button-text');
            const resultBox = document.getElementById('plan-results');
            const resultContent = document.getElementById('plan-content');

            const originalText = btnText.innerText;
            btn.disabled = true;
            btnText.innerText = 'ê³„íš ë¶„ì„ ì¤‘...';
            resultContent.innerHTML = '<span class="text-gray-500">ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê³„íšì„ ìˆ˜ë¦½ ì¤‘ì…ë‹ˆë‹¤...</span>';
            resultBox.classList.remove('hidden');

            const balanceStr = Object.entries(state.balance).map(([k, v]) => `${k}:${v}`).join(', ');
            
            const systemPrompt = "ë‹¹ì‹ ì€ ì „ë¬¸ì ì¸ ë¼ì´í”„ ì½”ì¹˜ì´ì ì˜ì„± ìƒë‹´ê°€ì…ë‹ˆë‹¤. ì‚¬ìš©ìì˜ í˜„ì¬ ì˜ì  ì—ë„ˆì§€ ê· í˜• ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê°€ì¥ ë‚®ì€ ë‘ ì˜ì—­ê³¼ ê°€ì¥ ë†’ì€ ì˜ì—­ ê°„ì˜ ì¡°í™”ë¥¼ ì´ë£¨ê¸° ìœ„í•œ ì‹¤ì§ˆì ì¸ í–‰ë™ ê³„íš(3ê°€ì§€)ì„ ë¶ˆë¦¿ í¬ì¸íŠ¸ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”. ì‘ë‹µì€ í•œêµ­ì–´ë¡œ ì‘ì„±í•˜ê³ , ë‹¤ë¥¸ ì„¤ëª… ì—†ì´ ë²ˆí˜¸ê°€ ë§¤ê²¨ì§„ ë¶ˆë¦¿ í¬ì¸íŠ¸ ë¦¬ìŠ¤íŠ¸(ì˜ˆ: 1. [ë‚´ìš©])ë§Œ ì œê³µí•˜ì„¸ìš”. ì¡´ëŒ“ë§ì„ ì‚¬ìš©í•˜ì„¸ìš”.";
            
            const userQuery = `ì‚¬ìš©ìì˜ í˜„ì¬ ì—ë„ˆì§€ ê· í˜•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤: ${balanceStr}. ì´ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ë§ì¶¤í˜• í–‰ë™ ê³„íš 3ê°€ì§€ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            try {
                const response = await exponentialBackoffFetch(apiUrl + `?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                let text = result.candidates?.[0]?.content?.parts?.[0]?.text || "ì£„ì†¡í•©ë‹ˆë‹¤. í–‰ë™ ê³„íšì„ ìƒì„±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.";

                // Format the output into HTML list items
                const planItems = text.split('\n').map(line => {
                    if (line.trim().startsWith('1.') || line.trim().startsWith('2.') || line.trim().startsWith('3.') || line.trim().startsWith('-')) {
                        return `<p class="flex items-start"><span class="mr-2 text-purple-500 font-bold">â€¢</span><span>${line.replace(/^[0-9]\.\s*/, '').replace(/^-+\s*/, '')}</span></p>`;
                    }
                    return '';
                }).join('');
                
                resultContent.innerHTML = planItems || `<p class="text-red-500">ê³„íš í¬ë§· ì˜¤ë¥˜: LLM ì‘ë‹µì„ í•´ì„í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.</p>`;

            } catch (error) {
                console.error("Gemini API Error for Plan:", error);
                resultContent.innerHTML = "API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.";
            } finally {
                btn.disabled = false;
                btnText.innerText = originalText;
            }
        }

        // --- Init ---
        window.addEventListener('DOMContentLoaded', () => {
            initCharts();
            setupSliders();
            renderStagesList();
            analyzeBalance(); 
            document.getElementById('plan-button').disabled = false; // Enable button on initial load
        });

    </script>
</body>
</html>